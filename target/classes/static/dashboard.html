<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Bank Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans">
  <!-- Navigation -->
  <nav class="bg-white shadow-lg border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <h1 class="text-2xl font-bold bg-gradient-to-r from-primary-600 to-primary-800 bg-clip-text text-transparent">
            Bank Management System
          </h1>
        </div>
        <div class="flex items-center space-x-4">
          <a href="/dashboard"
            class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-600 to-primary-700 rounded-md hover:from-primary-700 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 shadow-md hover:shadow-lg">
            Dashboard
          </a>
          <a href="/logout"
            class="px-4 py-2 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-all duration-200">
            Logout
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Balance Card -->
      <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden">
        <div class="p-6 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Account Balance</h2>
            <div class="h-8 w-8 rounded-full bg-primary-100 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-600" viewBox="0 0 20 20"
                fill="currentColor">
                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                <path fill-rule="evenodd"
                  d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                  clip-rule="evenodd" />
              </svg>
            </div>
          </div>
          <div id="balanceContainer" class="text-center cursor-pointer" onclick="showPinModal('check')">
            <div id="balance" class="hidden text-4xl font-bold text-gray-900">Loading...</div>
            <div id="balanceHidden" class="flex items-center justify-center space-x-2 py-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
              <span class="text-gray-500">Tap to check balance</span>
            </div>
          </div>
        </div>
        <div class="px-6 pb-6">
          <div class="grid grid-cols-2 gap-4">
            <button onclick="showModal('deposit')"
              class="w-full px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-green-500 to-green-600 rounded-lg hover:from-green-600 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200 shadow-sm hover:shadow-md">
              Deposit
            </button>
            <button onclick="showModal('withdraw')"
              class="w-full px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-red-500 to-red-600 rounded-lg hover:from-red-600 hover:to-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 shadow-sm hover:shadow-md">
              Withdraw
            </button>
          </div>
        </div>
      </div>

      <!-- Account Details Card -->
      <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden">
        <div class="p-6 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Account Details</h2>
            <div class="h-8 w-8 rounded-full bg-primary-100 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-600" viewBox="0 0 20 20"
                fill="currentColor">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
              </svg>
            </div>
          </div>
          <div id="accountInfo" class="space-y-3 text-gray-600">Loading...</div>
        </div>
        <div class="px-6 pb-6">
          <div class="flex flex-col space-y-3">
            <button onclick="showModal('update')"
              class="w-full px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg hover:from-primary-700 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 shadow-sm hover:shadow-md">
              Update Account
            </button>
            <button onclick="showPinUpdateModal()"
              class="w-full px-4 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              Update PIN
            </button>
            <button onclick="showDeleteAccountModal()"
              class="w-full px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 rounded-lg hover:from-red-700 hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200">
              Delete Account
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Transactions Card -->
      <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden">
        <div class="p-6 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Recent Transactions</h2>
            <div class="flex items-center space-x-3">
              <!-- Filter Dropdown -->
              <select id="transactionFilter" onchange="filterTransactions()"
                class="text-sm rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500">
                <option value="all">All Transactions</option>
                <option value="CREDIT">Deposits Only</option>
                <option value="DEBIT">Withdrawals Only</option>
              </select>
              <div class="h-8 w-8 rounded-full bg-primary-100 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-600" viewBox="0 0 20 20"
                  fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 4a1 1 0 000 2h6a1 1 0 100-2H7zm6 7a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm-4 1a1 1 0 00-1 1v2a1 1 0 102 0v-2a1 1 0 00-1-1z"
                    clip-rule="evenodd" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Transaction Stats -->
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="bg-green-50 rounded-lg p-3">
              <div class="text-sm text-green-600 font-medium">Total Deposits</div>
              <div id="totalDeposits" class="text-lg font-semibold text-green-700">₹0.00</div>
            </div>
            <div class="bg-red-50 rounded-lg p-3">
              <div class="text-sm text-red-600 font-medium">Total Withdrawals</div>
              <div id="totalWithdrawals" class="text-lg font-semibold text-red-700">₹0.00</div>
            </div>
          </div>

          <!-- Search Bar -->
          <div class="relative">
            <input type="text" id="transactionSearch" placeholder="Search transactions..."
              onkeyup="searchTransactions()"
              class="w-full pl-10 pr-4 py-2 rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500">
            <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20"
                fill="currentColor">
                <path fill-rule="evenodd"
                  d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                  clip-rule="evenodd" />
              </svg>
            </div>
          </div>

          <div class="flex justify-between items-center text-sm font-medium text-gray-500 pb-2 border-b">
            <span>Transaction</span>
            <span>Amount</span>
          </div>
          <div id="transactions"
            class="space-y-3 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
            <div class="text-gray-600 text-center py-4">Loading transactions...</div>
          </div>

          <!-- Empty State -->
          <div id="noTransactions" class="hidden text-center py-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            <p class="text-gray-600 font-medium">No transactions found</p>
            <p class="text-gray-500 text-sm mt-1">Try adjusting your search or filter settings</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Transaction Modal -->
  <div id="transactionModal"
    class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all">
      <div class="px-6 py-4 border-b border-gray-100">
        <div class="flex items-center justify-between">
          <h2 id="modalTitle" class="text-xl font-semibold text-gray-900">Transaction</h2>
          <button onclick="hideModal()" class="text-gray-400 hover:text-gray-500 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      <form id="transactionForm" onsubmit="handleTransaction(event)" class="px-6 py-4">
        <!-- Quick Amount Buttons -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-3">Quick Amount</label>
          <div class="grid grid-cols-3 gap-3">
            <button type="button" onclick="setAmount(500)"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              ₹500
            </button>
            <button type="button" onclick="setAmount(1000)"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              ₹1,000
            </button>
            <button type="button" onclick="setAmount(2000)"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              ₹2,000
            </button>
            <button type="button" onclick="setAmount(5000)"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              ₹5,000
            </button>
            <button type="button" onclick="setAmount(10000)"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              ₹10,000
            </button>
            <button type="button" onclick="setAmount(20000)"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
              ₹20,000
            </button>
          </div>
        </div>

        <!-- Custom Amount Input -->
        <div class="mb-6">
          <label for="amount" class="block text-sm font-medium text-gray-700 mb-2">Custom Amount</label>
          <div class="relative rounded-lg shadow-sm">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <span class="text-gray-500 sm:text-sm">₹</span>
            </div>
            <input type="number" id="amount" name="amount" step="0.01" min="0.01" required
              class="pl-7 block w-full rounded-lg border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all"
              placeholder="Enter amount">
            <div class="absolute inset-y-0 right-0 flex items-center">
              <label for="currency" class="sr-only">Currency</label>
              <select id="currency" name="currency"
                class="h-full py-0 pl-2 pr-7 border-transparent bg-transparent text-gray-500 sm:text-sm rounded-md">
                <option>INR</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Description Input -->
        <div class="mb-6">
          <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
            Description
            <span class="text-gray-400 font-normal">(Optional)</span>
          </label>
          <div class="relative rounded-lg shadow-sm">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20"
                fill="currentColor">
                <path fill-rule="evenodd"
                  d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                  clip-rule="evenodd" />
              </svg>
            </div>
            <input type="text" id="description" name="description"
              class="pl-10 block w-full rounded-lg border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all"
              placeholder="Add a note">
          </div>
        </div>

        <input type="hidden" id="transactionType" name="transactionType">

        <!-- Transaction Summary -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <div class="flex items-center justify-between text-sm">
            <span class="text-gray-500">Transaction Type</span>
            <span id="summaryType" class="font-medium text-gray-900">Deposit</span>
          </div>
          <div class="flex items-center justify-between text-sm mt-2">
            <span class="text-gray-500">Amount</span>
            <span id="summaryAmount" class="font-medium text-gray-900">₹0.00</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex space-x-3">
          <button type="submit" id="submitButton"
            class="flex-1 px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg hover:from-primary-700 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 shadow-md hover:shadow-lg">
            Confirm
          </button>
          <button type="button" onclick="hideModal()"
            class="flex-1 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Update Account Modal -->
  <div id="updateModal"
    class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all">
      <div class="px-6 py-4 border-b border-gray-100">
        <h2 class="text-xl font-semibold text-gray-900">Update Account</h2>
      </div>
      <form id="updateForm" onsubmit="handleUpdate(event)" class="px-6 py-4 space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="firstName" class="block text-sm font-medium text-gray-700">First Name</label>
            <input type="text" id="firstName" name="firstName" required
              class="mt-1 block w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500">
          </div>
          <div>
            <label for="lastName" class="block text-sm font-medium text-gray-700">Last Name</label>
            <input type="text" id="lastName" name="lastName" required
              class="mt-1 block w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500">
          </div>
        </div>
        <div>
          <label for="phoneNumber" class="block text-sm font-medium text-gray-700">Phone Number</label>
          <input type="tel" id="phoneNumber" name="phoneNumber" required
            class="mt-1 block w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500">
        </div>
        <div>
          <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
          <textarea id="address" name="address" rows="2" required
            class="mt-1 block w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500"></textarea>
        </div>
        <div class="flex space-x-3 pt-2">
          <button type="submit"
            class="flex-1 px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg hover:from-primary-700 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 shadow-sm hover:shadow-md">
            Update
          </button>
          <button type="button" onclick="hideUpdateModal()"
            class="flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- PIN Modal -->
  <div id="pinModal"
    class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all">
      <div class="px-6 py-4 border-b border-gray-100">
        <h2 id="pinModalTitle" class="text-xl font-semibold text-gray-900">Enter PIN</h2>
      </div>
      <div class="px-6 py-4 space-y-4">
        <div id="pinSetupMessage" class="hidden text-sm text-gray-600 mb-4">
          Please set up a 6-digit PIN to secure your balance checking
        </div>
        <div id="pinConfirmMessage" class="hidden text-sm text-gray-600 mb-4">
          Please confirm your PIN
        </div>
        <div class="flex justify-center space-x-3 mb-4">
          <div class="w-3 h-3 rounded-full bg-gray-200" id="pin1"></div>
          <div class="w-3 h-3 rounded-full bg-gray-200" id="pin2"></div>
          <div class="w-3 h-3 rounded-full bg-gray-200" id="pin3"></div>
          <div class="w-3 h-3 rounded-full bg-gray-200" id="pin4"></div>
          <div class="w-3 h-3 rounded-full bg-gray-200" id="pin5"></div>
          <div class="w-3 h-3 rounded-full bg-gray-200" id="pin6"></div>
        </div>
        <div class="grid grid-cols-3 gap-4">
          <button type="button" onclick="handlePinInput('1')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">1</button>
          <button type="button" onclick="handlePinInput('2')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">2</button>
          <button type="button" onclick="handlePinInput('3')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">3</button>
          <button type="button" onclick="handlePinInput('4')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">4</button>
          <button type="button" onclick="handlePinInput('5')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">5</button>
          <button type="button" onclick="handlePinInput('6')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">6</button>
          <button type="button" onclick="handlePinInput('7')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">7</button>
          <button type="button" onclick="handlePinInput('8')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">8</button>
          <button type="button" onclick="handlePinInput('9')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">9</button>
          <button type="button" onclick="hidePinModal()"
            class="p-4 text-xl font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors">✕</button>
          <button type="button" onclick="handlePinInput('0')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">0</button>
          <button type="button" onclick="handlePinInput('clear')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">←</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PIN Update Modal -->
  <div id="pinUpdateModal"
    class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all">
      <div class="px-6 py-4 border-b border-gray-100">
        <h2 class="text-xl font-semibold text-gray-900">Update PIN</h2>
      </div>
      <div class="p-6 space-y-6">
        <!-- Current PIN -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-4">Current PIN</label>
          <div class="flex justify-center space-x-3 mb-6">
            <div class="w-3 h-3 rounded-full bg-gray-200" id="currentPin1"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="currentPin2"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="currentPin3"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="currentPin4"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="currentPin5"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="currentPin6"></div>
          </div>
        </div>

        <!-- New PIN -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-4">New PIN</label>
          <div class="flex justify-center space-x-3 mb-6">
            <div class="w-3 h-3 rounded-full bg-gray-200" id="newPin1"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="newPin2"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="newPin3"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="newPin4"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="newPin5"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="newPin6"></div>
          </div>
        </div>

        <!-- Confirm New PIN -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-4">Confirm New PIN</label>
          <div class="flex justify-center space-x-3">
            <div class="w-3 h-3 rounded-full bg-gray-200" id="confirmPin1"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="confirmPin2"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="confirmPin3"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="confirmPin4"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="confirmPin5"></div>
            <div class="w-3 h-3 rounded-full bg-gray-200" id="confirmPin6"></div>
          </div>
        </div>

        <!-- Keypad -->
        <div class="grid grid-cols-3 gap-4 mt-6">
          <button type="button" onclick="handlePinUpdateInput('1')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">1</button>
          <button type="button" onclick="handlePinUpdateInput('2')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">2</button>
          <button type="button" onclick="handlePinUpdateInput('3')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">3</button>
          <button type="button" onclick="handlePinUpdateInput('4')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">4</button>
          <button type="button" onclick="handlePinUpdateInput('5')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">5</button>
          <button type="button" onclick="handlePinUpdateInput('6')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">6</button>
          <button type="button" onclick="handlePinUpdateInput('7')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">7</button>
          <button type="button" onclick="handlePinUpdateInput('8')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">8</button>
          <button type="button" onclick="handlePinUpdateInput('9')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">9</button>
          <button type="button" onclick="hidePinUpdateModal()"
            class="p-4 text-xl font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors">✕</button>
          <button type="button" onclick="handlePinUpdateInput('0')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">0</button>
          <button type="button" onclick="handlePinUpdateInput('clear')"
            class="p-4 text-xl font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">←</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-4"></div>

  <script>
    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR'
      }).format(amount);
    }

    // Format date
    function formatDate(dateString) {
      return new Date(dateString).toLocaleString('en-IN', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Fetch account details
    function fetchAccountDetails() {
      fetch('/api/banking/account', {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        credentials: 'include'
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch account details');
          }
          return response.json();
        })
        .then(data => {
          if (data.error) {
            throw new Error(data.error);
          }
          const accountInfo = document.getElementById('accountInfo');
          accountInfo.innerHTML = `
            <div class="space-y-3">
              <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <span class="text-sm text-gray-500">Account Number</span>
                <span class="text-sm font-medium text-gray-900">${data.accountNumber}</span>
              </div>
              <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <span class="text-sm text-gray-500">Account Type</span>
                <span class="text-sm font-medium text-gray-900">${data.accountType}</span>
              </div>
              <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <span class="text-sm text-gray-500">Name</span>
                <span class="text-sm font-medium text-gray-900">${data.firstName} ${data.lastName}</span>
              </div>
              <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <span class="text-sm text-gray-500">Phone</span>
                <span class="text-sm font-medium text-gray-900">${data.phoneNumber}</span>
              </div>
              <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <span class="text-sm text-gray-500">Address</span>
                <span class="text-sm font-medium text-gray-900">${data.address}</span>
              </div>
            </div>
          `;
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('accountInfo').innerHTML =
            `<div class="text-red-600 text-center py-4">${error.message}</div>`;
        });
    }

    // Fetch account balance
    function fetchBalance() {
      fetch('/api/banking/balance', {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        credentials: 'include'
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch balance');
          }
          return response.json();
        })
        .then(data => {
          if (data.error) {
            throw new Error(data.error);
          }
          document.getElementById('balance').textContent = formatCurrency(data.balance);
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('balance').innerHTML =
            `<div class="text-red-600">${error.message}</div>`;
        });
    }

    // Add these new functions for enhanced transaction history
    let allTransactions = [];

    function filterTransactions() {
      const filterValue = document.getElementById('transactionFilter').value;
      const searchValue = document.getElementById('transactionSearch').value.toLowerCase();

      let filteredTransactions = allTransactions;

      if (filterValue !== 'all') {
        filteredTransactions = filteredTransactions.filter(t => t.transactionType === filterValue);
      }

      if (searchValue) {
        filteredTransactions = filteredTransactions.filter(t =>
          t.description?.toLowerCase().includes(searchValue) ||
          formatCurrency(t.amount).toLowerCase().includes(searchValue) ||
          formatDate(t.transactionDate).toLowerCase().includes(searchValue)
        );
      }

      updateTransactionDisplay(filteredTransactions);
    }

    function searchTransactions() {
      filterTransactions();
    }

    function updateTransactionDisplay(transactions) {
      const transactionsDiv = document.getElementById('transactions');
      const noTransactionsDiv = document.getElementById('noTransactions');

      if (!transactions || transactions.length === 0) {
        transactionsDiv.classList.add('hidden');
        noTransactionsDiv.classList.remove('hidden');
        return;
      }

      transactionsDiv.classList.remove('hidden');
      noTransactionsDiv.classList.add('hidden');

      transactionsDiv.innerHTML = transactions.map(transaction => `
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
          <div class="flex-1">
            <div class="flex items-center space-x-3">
              <div class="flex items-center space-x-2">
                <div class="h-2 w-2 rounded-full ${transaction.transactionType === 'CREDIT' ? 'bg-green-500' : 'bg-red-500'}"></div>
                <div class="text-sm font-medium ${transaction.transactionType === 'CREDIT' ? 'text-green-600' : 'text-red-600'}">
                  ${transaction.transactionType === 'CREDIT' ? '+ ' : '- '}${formatCurrency(transaction.amount)}
                </div>
              </div>
              <div class="text-xs px-2 py-1 rounded-full ${transaction.transactionType === 'CREDIT' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                ${transaction.transactionType === 'CREDIT' ? 'Deposit' : 'Withdrawal'}
              </div>
            </div>
            <div class="text-sm text-gray-600 mt-1">${transaction.description || 'No description'}</div>
            <div class="flex items-center space-x-2 mt-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
              </svg>
              <span class="text-xs text-gray-500">${formatDate(transaction.transactionDate)}</span>
            </div>
          </div>
          <div class="ml-4">
            <div class="text-xs font-medium text-gray-500">Transaction ID</div>
            <div class="text-sm font-mono text-gray-600">#${transaction.id}</div>
          </div>
        </div>
      `).join('');
    }

    // Modify the fetchTransactions function to include the new features
    function fetchTransactions() {
      fetch('/api/banking/transactions', {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        },
        credentials: 'include'
      })
        .then(response => {
          if (!response.ok) {
            return response.json().then(err => {
              throw new Error(err.error || 'Failed to fetch transactions');
            });
          }
          return response.json();
        })
        .then(data => {
          allTransactions = data;
          updateTransactionDisplay(data);
          updateTransactionStats(data);
        })
        .catch(error => {
          document.getElementById('transactions').innerHTML =
            `<div class="text-red-600 text-center py-4">${error.message}</div>`;
          console.error('Error:', error);
        });
    }

    function updateTransactionStats(transactions) {
      const totalDeposits = transactions
        .filter(t => t.transactionType === 'CREDIT')
        .reduce((sum, t) => sum + t.amount, 0);

      const totalWithdrawals = transactions
        .filter(t => t.transactionType === 'DEBIT')
        .reduce((sum, t) => sum + t.amount, 0);

      document.getElementById('totalDeposits').textContent = formatCurrency(totalDeposits);
      document.getElementById('totalWithdrawals').textContent = formatCurrency(totalWithdrawals);
    }

    // Show transaction modal
    function showModal(type) {
      if (type === 'update') {
        document.getElementById('updateModal').classList.remove('hidden');
        // Populate the update form with current details
        fetch('/api/banking/account', {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          },
          credentials: 'include'
        })
          .then(response => response.json())
          .then(data => {
            document.getElementById('firstName').value = data.firstName;
            document.getElementById('lastName').value = data.lastName;
            document.getElementById('phoneNumber').value = data.phoneNumber;
            document.getElementById('address').value = data.address;
          });
      } else {
        document.getElementById('modalTitle').textContent = type === 'deposit' ? 'Make a Deposit' : 'Make a Withdrawal';
        document.getElementById('transactionType').value = type;
        document.getElementById('transactionModal').classList.remove('hidden');
        document.getElementById('amount').value = '';
        document.getElementById('description').value = '';
        updateTransactionSummary();
      }
    }

    // Hide transaction modal
    function hideModal() {
      document.getElementById('transactionModal').classList.add('hidden');
      document.getElementById('transactionForm').reset();
    }

    // Hide update modal
    function hideUpdateModal() {
      document.getElementById('updateModal').classList.add('hidden');
      document.getElementById('updateForm').reset();
    }

    // Add Toast Notification System
    function showToast(message, type = 'info') {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');

      // Define icons for different toast types
      const icons = {
        success: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>`,
        error: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
        </svg>`,
        warning: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>`,
        info: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>`
      };

      // Define colors for different toast types
      const colors = {
        success: 'bg-green-50 text-green-800 border-green-200',
        error: 'bg-red-50 text-red-800 border-red-200',
        warning: 'bg-yellow-50 text-yellow-800 border-yellow-200',
        info: 'bg-blue-50 text-blue-800 border-blue-200'
      };

      const iconColors = {
        success: 'text-green-400',
        error: 'text-red-400',
        warning: 'text-yellow-400',
        info: 'text-blue-400'
      };

      toast.className = `flex items-center p-4 mb-4 rounded-lg border ${colors[type]} transform transition-all duration-300 ease-in-out translate-x-full`;
      toast.innerHTML = `
        <div class="inline-flex flex-shrink-0 justify-center items-center w-8 h-8 ${iconColors[type]}">
          ${icons[type]}
        </div>
        <div class="ml-3 text-sm font-normal">${message}</div>
        <button type="button" class="ml-auto -mx-1.5 -my-1.5 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 inline-flex h-8 w-8 hover:bg-gray-100 hover:text-gray-900" onclick="this.parentElement.remove()">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </button>
      `;

      toastContainer.appendChild(toast);

      // Animate the toast in
      requestAnimationFrame(() => {
        toast.classList.remove('translate-x-full');
      });

      // Auto remove after 5 seconds
      setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 5000);
    }

    // Modify the handleTransaction function to use the new toast system
    function handleTransaction(event) {
      event.preventDefault();
      const type = document.getElementById('transactionType').value;
      const amount = document.getElementById('amount').value;
      const description = document.getElementById('description').value || undefined;

      const url = `/api/banking/${type}`;
      const params = new URLSearchParams();
      params.append('amount', amount);
      if (description) {
        params.append('description', description);
      }

      fetch(`${url}?${params}`, {
        method: 'POST',
        headers: {
          'Accept': 'application/json'
        },
        credentials: 'include'
      })
        .then(response => {
          if (!response.ok) {
            return response.json().then(err => {
              throw new Error(err.error || 'Transaction failed');
            });
          }
          return response.json();
        })
        .then(() => {
          hideModal();
          fetchBalance();
          fetchTransactions();
          showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} successful! Amount: ${formatCurrency(amount)}`, 'success');
        })
        .catch(error => {
          let errorMessage = error.message;
          let toastType = 'error';

          // Handle specific error cases
          if (errorMessage.toLowerCase().includes('insufficient')) {
            errorMessage = `Insufficient balance for this withdrawal. Available balance: ${formatCurrency(document.getElementById('balance').textContent.replace(/[^0-9.-]+/g, ''))}`;
            toastType = 'warning';
          } else if (errorMessage.toLowerCase().includes('invalid')) {
            toastType = 'warning';
          }

          showToast(errorMessage, toastType);
          console.error('Error:', error);
        });
    }

    // Modify other alert calls to use the toast system
    function handleUpdate(event) {
      event.preventDefault();
      const formData = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        phoneNumber: document.getElementById('phoneNumber').value,
        address: document.getElementById('address').value
      };

      fetch('/api/banking/account/update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        credentials: 'include',
        body: JSON.stringify(formData)
      })
        .then(response => {
          if (!response.ok) {
            return response.json().then(err => {
              throw new Error(err.error || 'Update failed');
            });
          }
          return response.json();
        })
        .then(() => {
          hideUpdateModal();
          fetchAccountDetails();
          showToast('Account details updated successfully!', 'success');
        })
        .catch(error => {
          showToast(error.message, 'error');
          console.error('Error:', error);
        });
    }

    let currentPin = '';
    let tempPin = '';
    let pinMode = '';

    function showPinModal(mode) {
      pinMode = mode;
      currentPin = '';
      document.getElementById('pinModal').classList.remove('hidden');

      // Check if PIN is already set
      fetch('/api/banking/check-pin', {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        },
        credentials: 'include'
      })
        .then(response => response.json())
        .then(data => {
          if (!data.pinSet) {
            document.getElementById('pinModalTitle').textContent = 'Set Up PIN';
            document.getElementById('pinSetupMessage').classList.remove('hidden');
            pinMode = 'setup';
          } else {
            document.getElementById('pinModalTitle').textContent = 'Enter PIN';
            document.getElementById('pinSetupMessage').classList.add('hidden');
          }
        });

      updatePinDisplay();
    }

    function hidePinModal() {
      document.getElementById('pinModal').classList.add('hidden');
      document.getElementById('pinSetupMessage').classList.add('hidden');
      document.getElementById('pinConfirmMessage').classList.add('hidden');
      currentPin = '';
      tempPin = '';
      updatePinDisplay();
    }

    function handlePinInput(value) {
      if (value === 'clear') {
        currentPin = currentPin.slice(0, -1);
      } else if (currentPin.length < 6) {
        currentPin += value;
      }

      updatePinDisplay();

      if (currentPin.length === 6) {
        if (pinMode === 'setup') {
          if (!tempPin) {
            tempPin = currentPin;
            currentPin = '';
            document.getElementById('pinSetupMessage').classList.add('hidden');
            document.getElementById('pinConfirmMessage').classList.remove('hidden');
            document.getElementById('pinModalTitle').textContent = 'Confirm PIN';
            updatePinDisplay();
          } else {
            if (tempPin === currentPin) {
              // Save PIN
              fetch('/api/banking/set-pin', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Accept': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({ pin: currentPin })
              })
                .then(response => {
                  if (response.ok) {
                    hidePinModal();
                    showBalance();
                    showToast('PIN set successfully!', 'success');
                  }
                });
            } else {
              showToast('PINs do not match. Please try again.', 'error');
              tempPin = '';
              currentPin = '';
              document.getElementById('pinConfirmMessage').classList.add('hidden');
              document.getElementById('pinSetupMessage').classList.remove('hidden');
              document.getElementById('pinModalTitle').textContent = 'Set Up PIN';
              updatePinDisplay();
            }
          }
        } else {
          // Verify PIN
          fetch('/api/banking/verify-pin', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({ pin: currentPin })
          })
            .then(response => {
              if (response.ok) {
                hidePinModal();
                showBalance();
              } else {
                showToast('Incorrect PIN. Please try again.', 'error');
                currentPin = '';
                updatePinDisplay();
              }
            });
        }
      }
    }

    function updatePinDisplay() {
      for (let i = 1; i <= 6; i++) {
        const dot = document.getElementById(`pin${i}`);
        if (i <= currentPin.length) {
          dot.classList.remove('bg-gray-200');
          dot.classList.add('bg-primary-600');
        } else {
          dot.classList.remove('bg-primary-600');
          dot.classList.add('bg-gray-200');
        }
      }
    }

    function showBalance() {
      document.getElementById('balanceHidden').classList.add('hidden');
      document.getElementById('balance').classList.remove('hidden');
      fetchBalance();
    }

    let pinUpdateStep = 'current'; // 'current', 'new', 'confirm'
    let currentPinInput = '';
    let newPinInput = '';
    let confirmPinInput = '';

    function showPinUpdateModal() {
      document.getElementById('pinUpdateModal').classList.remove('hidden');
      pinUpdateStep = 'current';
      currentPinInput = '';
      newPinInput = '';
      confirmPinInput = '';
      updatePinUpdateDisplay();
    }

    function hidePinUpdateModal() {
      document.getElementById('pinUpdateModal').classList.add('hidden');
      pinUpdateStep = 'current';
      currentPinInput = '';
      newPinInput = '';
      confirmPinInput = '';
      updatePinUpdateDisplay();
    }

    function handlePinUpdateInput(value) {
      let currentInput = '';
      switch (pinUpdateStep) {
        case 'current':
          currentInput = currentPinInput;
          break;
        case 'new':
          currentInput = newPinInput;
          break;
        case 'confirm':
          currentInput = confirmPinInput;
          break;
      }

      if (value === 'clear') {
        currentInput = currentInput.slice(0, -1);
      } else if (currentInput.length < 6) {
        currentInput += value;
      }

      switch (pinUpdateStep) {
        case 'current':
          currentPinInput = currentInput;
          if (currentPinInput.length === 6) {
            // Verify current PIN
            fetch('/api/banking/verify-pin', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              },
              credentials: 'include',
              body: JSON.stringify({ pin: currentPinInput })
            })
              .then(response => {
                if (response.ok) {
                  pinUpdateStep = 'new';
                  updatePinUpdateDisplay();
                } else {
                  alert('Incorrect current PIN');
                  currentPinInput = '';
                  updatePinUpdateDisplay();
                }
              });
          }
          break;
        case 'new':
          newPinInput = currentInput;
          if (newPinInput.length === 6) {
            pinUpdateStep = 'confirm';
          }
          break;
        case 'confirm':
          confirmPinInput = currentInput;
          if (confirmPinInput.length === 6) {
            if (newPinInput === confirmPinInput) {
              // Update PIN
              fetch('/api/banking/update-pin', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Accept': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({ pin: newPinInput })
              })
                .then(response => {
                  if (response.ok) {
                    alert('PIN updated successfully');
                    hidePinUpdateModal();
                  } else {
                    alert('Failed to update PIN');
                    confirmPinInput = '';
                    updatePinUpdateDisplay();
                  }
                });
            } else {
              alert('New PINs do not match');
              newPinInput = '';
              confirmPinInput = '';
              pinUpdateStep = 'new';
              updatePinUpdateDisplay();
            }
          }
          break;
      }
      updatePinUpdateDisplay();
    }

    function updatePinUpdateDisplay() {
      // Update current PIN display
      for (let i = 1; i <= 6; i++) {
        const dot = document.getElementById(`currentPin${i}`);
        if (i <= currentPinInput.length) {
          dot.classList.remove('bg-gray-200');
          dot.classList.add('bg-primary-600');
        } else {
          dot.classList.remove('bg-primary-600');
          dot.classList.add('bg-gray-200');
        }
      }

      // Update new PIN display
      for (let i = 1; i <= 6; i++) {
        const dot = document.getElementById(`newPin${i}`);
        if (i <= newPinInput.length) {
          dot.classList.remove('bg-gray-200');
          dot.classList.add('bg-primary-600');
        } else {
          dot.classList.remove('bg-primary-600');
          dot.classList.add('bg-gray-200');
        }
      }

      // Update confirm PIN display
      for (let i = 1; i <= 6; i++) {
        const dot = document.getElementById(`confirmPin${i}`);
        if (i <= confirmPinInput.length) {
          dot.classList.remove('bg-gray-200');
          dot.classList.add('bg-primary-600');
        } else {
          dot.classList.remove('bg-primary-600');
          dot.classList.add('bg-gray-200');
        }
      }
    }

    // Add these new functions for the enhanced transaction UI
    function setAmount(amount) {
      document.getElementById('amount').value = amount;
      updateTransactionSummary();
    }

    function updateTransactionSummary() {
      const amount = document.getElementById('amount').value;
      const type = document.getElementById('transactionType').value;

      document.getElementById('summaryType').textContent = type.charAt(0).toUpperCase() + type.slice(1);
      document.getElementById('summaryAmount').textContent = amount ? formatCurrency(parseFloat(amount)) : '₹0.00';

      // Update submit button style based on transaction type
      const submitButton = document.getElementById('submitButton');
      if (type === 'deposit') {
        submitButton.classList.remove('from-red-600', 'to-red-700', 'hover:from-red-700', 'hover:to-red-800', 'focus:ring-red-500');
        submitButton.classList.add('from-green-600', 'to-green-700', 'hover:from-green-700', 'hover:to-green-800', 'focus:ring-green-500');
      } else {
        submitButton.classList.remove('from-green-600', 'to-green-700', 'hover:from-green-700', 'hover:to-green-800', 'focus:ring-green-500');
        submitButton.classList.add('from-red-600', 'to-red-700', 'hover:from-red-700', 'hover:to-red-800', 'focus:ring-red-500');
      }
    }

    // Add event listener for amount input
    document.getElementById('amount').addEventListener('input', updateTransactionSummary);

    // Initial load
    fetchBalance();
    fetchTransactions();
    fetchAccountDetails();
  </script>
</body>

</html>